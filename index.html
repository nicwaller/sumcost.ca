<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SumCost.ca - True Cost Calculator for Canadian Taxes</title>
    <meta name="description"
          content="Calculate the true cost of purchases in Canada with comprehensive tax analysis. Includes federal/provincial income tax, sales tax (GST/PST/HST), time cost analysis, and retirement opportunity cost calculations.">
    <meta name="keywords"
          content="Canadian tax calculator, income tax, sales tax, GST, PST, HST, cost calculator, true cost, Canada, time value of money, opportunity cost, retirement savings, working days calculator">
    <meta name="author" content="Nic Waller">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="SumCost.ca - True Cost Calculator for Canadian Taxes">
    <meta property="og:description"
          content="Calculate the true cost of purchases in Canada with comprehensive tax analysis. Includes federal/provincial income tax, sales tax (GST/PST/HST), time cost analysis, and retirement opportunity cost calculations.">
    <meta property="og:url" content="https://sumcost.ca">
    <meta property="og:site_name" content="SumCost.ca">
    <meta property="og:image" content="https://sumcost.ca/ogpreview.jpg">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SumCost.ca - True Cost Calculator for Canadian Taxes">
    <meta name="twitter:description"
          content="Calculate the true cost of purchases in Canada with comprehensive tax analysis. Includes federal/provincial income tax, sales tax (GST/PST/HST), time cost analysis, and retirement opportunity cost calculations.">
    <meta name="twitter:image" content="https://sumcost.ca/twitter-card-image.jpg">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://sumcost.ca">

    <!-- Additional SEO -->
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#667eea">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2d3748">
    <meta name="application-name" content="SumCost.ca">

    <!-- GitHub and Repository Info -->
    <meta name="repository-url" content="https://github.com/nicwaller/sumcost.ca">
    <meta name="source-code" content="https://github.com/nicwaller/sumcost.ca">

    <!-- Language and Region -->
    <meta name="language" content="en-CA">
    <meta name="geo.region" content="CA">

    <!-- PWA/Mobile App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="SumCost">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebApplication",
            "name": "SumCost.ca",
            "description": "Calculate the true cost of purchases in Canada with comprehensive tax analysis, time cost calculations, and retirement opportunity cost modeling",
            "url": "https://sumcost.ca",
            "applicationCategory": "FinanceApplication",
            "operatingSystem": "Web Browser",
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "CAD"
            },
            "codeRepository": "https://github.com/nicwaller/sumcost.ca"
        }
    </script>
    <style>
        :root {
            --bg: #667eea;
            --card-bg: white;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --text-primary: #333;
            --text-secondary: #555;
            --text-muted: #666;
            --text-placeholder: #999;
            --border-color: #e1e1e1;
            --border-focus: #667eea;
            --border-separator: #ddd;
            --border-dotted: #ccc;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #2d3748;
                --card-bg: #1a202c;
                --card-shadow: rgba(0, 0, 0, 0.3);
                --text-primary: #f7fafc;
                --text-secondary: #a0aec0;
                --text-muted: #a0aec0;
                --text-placeholder: #a0aec0;
                --border-color: #4a5568;
                --border-focus: #4299e1;
                --border-separator: #4a5568;
                --border-dotted: #718096;
            }
        }

        html, body, fieldset {
            margin: 0;
            padding: 0;
        }

        body {
            padding-left: max(20px, 1.5 * env(safe-area-inset-left));
            padding-right: max(20px, 1.5 * env(safe-area-inset-right));

            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;

            background: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text-primary);
        }

        main {
            padding-top: 2em;
            padding-bottom: 2em;
            width: 100%;

            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
        }

        main > section {
            flex-grow: 1;
        }

        section {
            padding: 30px;
            /*flex-basis: 20em;*/
            min-width: 20em;

            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 40px var(--card-shadow);
        }

        h1 {
            margin: 0;
            font-size: 200%;
        }

        form {
            fieldset {
                margin-top: 2ex;
                border: 0;
            }

            label {
                display: flex;
                align-items: center;
                margin-bottom: 1ex;

                font-weight: 600;
            }

            /* Chrome, Safari, Edge, Opera */

            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            /* Firefox */

            input[type=number] {
                -moz-appearance: textfield;
            }

            input[type=number], select {
                box-sizing: border-box;
                width: 100%;
                padding: 2ex;

                border: 2px solid var(--border-color);
                border-radius: 8px;
                font-size: 16px;
                background: var(--card-bg);
                color: var(--text-primary);
            }

            input:focus, select:focus {
                outline: none;
                border-color: var(--border-focus);
            }

            input[type="checkbox"] {
                width: auto;
                margin-right: 1ex;
                transform: scale(1.3);
            }
        }

        .result-row {
            display: flex;
            justify-content: space-between;
        }
        .muted {
            color: var(--text-muted);
        }
        .dollars:before {
            content: "$";
        }

        details {
            width: 100%;
        }

        summary {
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            list-style: none;
            padding: 2px 0;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        /*#salesTaxBreakdown, #incomeTaxBreakdown {*/
        /*    padding: 10px 0 0 20px;*/
        /*    font-size: 0.9em;*/
        /*    color: var(--text-muted);*/
        /*}*/

        /*.tax-breakdown-item {*/
        /*    display: flex;*/
        /*    justify-content: space-between;*/
        /*    margin-bottom: 5px;*/
        /*}*/

        footer {
            width: 100%;
            text-align: center;
            font-size: 14px;
            margin-bottom: 3em;
            color: var(--text-secondary);

            a {
                color: inherit;
            }
        }
    </style>
</head>
<body>
<main>
    <section>
        <h1>Purchase</h1>
        <p>How much is your intended purchase?</p>

        <form id="purchaseForm">
            <fieldset>
                <label for="purchasePrice">Purchase Price ($)</label>
                <input type="number" id="purchasePrice" value="1000.00" step="100.00" min="0" inputmode="decimal" required autofocus>
            </fieldset>

            <fieldset>
                <label for="province">Province</label>
                <select id="province" required>
                    <option value="AB">Alberta</option>
                    <option value="BC" selected>British Columbia</option>
                    <option value="MB">Manitoba</option>
                    <option value="NB">New Brunswick</option>
                    <option value="NL">Newfoundland and Labrador</option>
                    <option value="NT">Northwest Territories</option>
                    <option value="NS">Nova Scotia</option>
                    <option value="NU">Nunavut</option>
                    <option value="ON">Ontario</option>
                    <option value="PE">Prince Edward Island</option>
                    <option value="QC">Quebec</option>
                    <option value="SK">Saskatchewan</option>
                    <option value="YT">Yukon</option>
                </select>
            </fieldset>

            <fieldset>
                <label for="includeSalesTax">
                    <input type="checkbox" id="includeSalesTax" checked>
                    Add Sales Tax
                </label>
            </fieldset>
        </form>

        <div class="outputs">
            <div class="result-row muted" id="gst-row">
                <span>GST</span>
                <output id="GST" class="dollars">0.00</output>
            </div>
            <div class="result-row muted" id="pst-row">
                <span>PST</span>
                <output id="PST" class="dollars">0.00</output>
            </div>
            <div class="result-row muted" id="hst-row">
                <span>HST</span>
                <output id="HST" class="dollars">0.00</output>
            </div>
            <div class="result-row" id="sales-tax-row">
                <span>Sales Tax:</span>
                <output id="salesTax" class="dollars">0.00</output>
            </div>
            <div class="result-row">
                <span>Subtotal</span>
                <output id="subtotal" class="dollars">0.00</output>
            </div>
        </div>
    </section>

    <section>
        <h1>Income Tax</h1>
        <p>What is your gross annual income? (how much you are paid before subtracting taxes)</p>

        <form id="incomeForm">
            <fieldset>
                <label for="income">Gross Annual Income ($)</label>
                <input type="number" id="income" value="60000" min="0" step="10000" inputmode="numeric" required>
                <div id="income-warning" style="display: none">
                    <p>
                        ⚠️Warning: the purchase subtotal is more than your annual disposable income.
                        This calculator is not designed to amortize large expenses over multiple years, so the results are invalid.
                    </p>

                    <div class="outputs">
                        <div class="result-row muted" id="disposable-income-row">
                            <span>Disposable Income</span>
                            <output id="disposable-income" class="dollars">0.00</output>
                        </div>
                    </div>
                </div>
            </fieldset>
        </form>

        <p>Total amount you need to earn to pay for this purchase.</p>
        <div class="outputs">
            <div class="result-row muted" id="subtotal-2-row">
                <span>Subtotal</span>
                <output id="subtotal-2" class="dollars">0.00</output>
            </div>
            <div class="result-row muted" id="federal-tax-row">
                <span>Federal Tax</span>
                <output id="federal-tax" class="dollars">0.00</output>
            </div>
            <div class="result-row muted" id="provincial-tax-row">
                <span>Provincial Tax</span>
                <output id="provincial-tax" class="dollars">0.00</output>
            </div>
            <div class="result-row" id="required-earnings-row">
                <span>Required Earnings</span>
                <output id="required-earnings" class="dollars">0.00</output>
            </div>
        </div>

    </section>

    <section>
        <h1>Time Cost</h1>
        <p>How many days do you normally work each year? Full-time in Canada is 250 days per year.</p>

        <form id="timeForm">
            <fieldset>
                <label for="days-worked">Days Worked</label>
                <input id="days-worked" type="number" value="250" min="1" max="365" step="30" inputmode="numeric" required>
            </fieldset>
        </form>

        <p>This is how long it will take to pay off that expense.</p>

        <div class="result-row">
            <span>Working Days:</span>
            <span id="required-working-days">0.0</span>
        </div>
        <div class="result-row">
            <span>Calendar Days:</span>
            <span id="required-calendar-days">0.0</span>
        </div>
    </section>

    <section>
        <h1>Time Value of Money</h1>
        <p>How many years until you retire? This shows the opportunity cost of your purchase in terms of foregone retirement savings.</p>

        <form id="retirementForm">
            <fieldset>
                <label for="years-to-retirement">Years to Retirement</label>
                <input id="years-to-retirement" type="number" value="30" min="0" max="50" step="5" inputmode="numeric" required>
            </fieldset>
            <fieldset>
                <label for="expected-return">Expected Annual Return (%)</label>
                <input id="expected-return" type="number" value="7" min="0" max="15" step="0.5" inputmode="decimal" required>
            </fieldset>
        </form>

        <p>This is how much retirement savings you would forego by making this purchase instead of investing.</p>

        <div class="result-row">
            <span>Foregone Retirement Savings:</span>
            <output id="foregone-savings" class="dollars">0.00</output>
        </div>
    </section>
</main>

<footer class="footer">
    <p>
        Created by Nic Waller
        •
        <a href="https://github.com/nicwaller/sumcost.ca" target="_blank" rel="noopener">View on GitHub</a>
        •
        <a href="https://dashboard.simpleanalytics.com/sumcost.ca?period=week&count=1&interval=day" target="_blank" rel="noopener">Simple Analytics</a>
    </p>
</footer>

<script>
    const salesTaxRates = {
        'AB': {gst: 5, pst: 0, hst: 0},
        'BC': {gst: 5, pst: 7, hst: 0},
        'MB': {gst: 5, pst: 7, hst: 0},
        'NB': {gst: 0, pst: 0, hst: 15},
        'NL': {gst: 0, pst: 0, hst: 15},
        'NT': {gst: 5, pst: 0, hst: 0},
        'NS': {gst: 0, pst: 0, hst: 15},
        'NU': {gst: 5, pst: 0, hst: 0},
        'ON': {gst: 0, pst: 0, hst: 13},
        'PE': {gst: 0, pst: 0, hst: 15},
        'QC': {gst: 5, pst: 9.975, hst: 0},
        'SK': {gst: 5, pst: 6, hst: 0},
        'YT': {gst: 5, pst: 0, hst: 0}
    };

    const incomeTaxBrackets = {
        federal: [
            {min: 0, max: 55867, rate: 0.15},
            {min: 55867, max: 111733, rate: 0.205},
            {min: 111733, max: 173205, rate: 0.26},
            {min: 173205, max: 246752, rate: 0.29},
            {min: 246752, max: Infinity, rate: 0.33}
        ],
        provincial: {
            'AB': [
                {min: 0, max: 148269, rate: 0.10},
                {min: 148269, max: 177922, rate: 0.12},
                {min: 177922, max: 237675, rate: 0.13},
                {min: 237675, max: 355513, rate: 0.14},
                {min: 355513, max: Infinity, rate: 0.15}
            ],
            'BC': [
                {min: 0, max: 47937, rate: 0.0506},
                {min: 47937, max: 95875, rate: 0.077},
                {min: 95875, max: 110076, rate: 0.105},
                {min: 110076, max: 133664, rate: 0.1229},
                {min: 133664, max: 181232, rate: 0.147},
                {min: 181232, max: Infinity, rate: 0.168}
            ],
            'ON': [
                {min: 0, max: 51446, rate: 0.0505},
                {min: 51446, max: 102894, rate: 0.0915},
                {min: 102894, max: 150000, rate: 0.1116},
                {min: 150000, max: 220000, rate: 0.1216},
                {min: 220000, max: Infinity, rate: 0.1316}
            ],
            'QC': [
                {min: 0, max: 49275, rate: 0.14},
                {min: 49275, max: 98540, rate: 0.19},
                {min: 98540, max: 119910, rate: 0.24},
                {min: 119910, max: Infinity, rate: 0.2575}
            ]
        }
    };

    function purchaseFormDidChange() {
        const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0.0;
        const includeSalesTax = document.getElementById('includeSalesTax').checked;
        const province = document.getElementById('province').value;

        if (province) {
            localStorage.setItem('sumcost-province', province);
        }

        const gstRate = includeSalesTax ? salesTaxRates[province].gst / 100.0 : 0;
        const pstRate = includeSalesTax ? salesTaxRates[province].pst / 100.0 : 0;
        const hstRate = includeSalesTax ? salesTaxRates[province].hst / 100.0 : 0;

        const gst = gstRate * purchasePrice;
        const pst = pstRate * purchasePrice;
        const hst = hstRate * purchasePrice;

        const salesTax = gst + pst + hst;
        const subtotal = purchasePrice + salesTax;

        document.getElementById('gst-row').style.display = (gstRate === 0 ? 'none' : 'flex');
        document.getElementById('pst-row').style.display = (pstRate === 0 ? 'none' : 'flex');
        document.getElementById('hst-row').style.display = (hstRate === 0 ? 'none' : 'flex');
        document.getElementById('sales-tax-row').style.display = (includeSalesTax ? 'flex' : 'none');
        document.getElementById('GST').textContent = `${gst.toFixed(2)}`;
        document.getElementById('PST').textContent = `${pst.toFixed(2)}`;
        document.getElementById('HST').textContent = `${hst.toFixed(2)}`;
        document.getElementById('salesTax').textContent = `${salesTax.toFixed(2)}`;
        document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)}`;

        incomeFormDidChange();
    }

    document.getElementById('purchasePrice').addEventListener('input', purchaseFormDidChange);
    document.getElementById('province').addEventListener('change', purchaseFormDidChange);
    document.getElementById('includeSalesTax').addEventListener('change', purchaseFormDidChange);
    document.getElementById('purchaseForm').addEventListener('submit', purchaseFormDidChange);

    function incomeFormDidChange() {
        const subtotal = parseFloat(document.getElementById('subtotal').textContent) || 0.0;
        const annualIncome = parseFloat(document.getElementById('income').value);
        const province = document.getElementById('province').value;

        if (annualIncome) {
            localStorage.setItem('sumcost-annual-income', annualIncome.toFixed(0));
        }

        const federalBrackets = incomeTaxBrackets.federal;
        const provinceBrackets = incomeTaxBrackets.provincial[province];

        let brackets = combineBrackets(federalBrackets, provinceBrackets);
        const disposableIncome = calculateDisposableIncome(annualIncome, brackets);

        document.getElementById('income-warning').style.display = (subtotal > disposableIncome ? 'block' : 'none');
        document.getElementById('disposable-income').textContent = disposableIncome.toFixed(2);

        // TODO: verify this function
        function combineBrackets(fedBrackets, provBrackets) {
            let comboBracket = []
            let i = 0;
            let j = 0;
            let fedBracketCurrent = fedBrackets[i];
            let provBracketCurrent = provBrackets[j];
            let threshold = 0;
            // assume that brackets are sorted in ascending order
            for (; i < fedBrackets.length && j < provBrackets.length;) {
                fedBracketCurrent = fedBrackets[i];
                provBracketCurrent = provBrackets[j];
                let newThreshold = -1;
                if (fedBracketCurrent.max < provBracketCurrent.max) {
                    newThreshold = fedBracketCurrent.max;
                    i++;
                } else {
                    newThreshold = provBracketCurrent.max;
                    j++;
                }

                comboBracket.push({
                    min: threshold,
                    max: newThreshold,
                    rate: fedBracketCurrent.rate + provBracketCurrent.rate,
                    fedRate: fedBracketCurrent.rate,
                    provRate: provBracketCurrent.rate,
                });

                threshold = newThreshold;
            }
            return comboBracket;
        }

        function calculateDisposableIncome(income, brackets) {
            let disposable = 0.0;
            // assume that brackets are sorted in ascending order
            for (let i = brackets.length - 1; i >= 0; i--) {
                const bracket = brackets[i];

                if (income < bracket.min) {
                    continue
                }
                if (income <= 0.0) {
                    break
                }

                const bracketGrossIncome = income - bracket.min;
                income -= bracketGrossIncome;

                const bracketTaxPayable = bracketGrossIncome * bracket.rate;
                const bracketNetIncome = bracketGrossIncome - bracketTaxPayable;

                disposable += bracketNetIncome;
            }
            return disposable;
        }

        function calculateRequiredEarningsAndTax(expense, income, brackets) {
            let result = {
                requiredEarnings: 0.0,
                federalTax: 0.0,
                provincialTax: 0.0,
            };
            // assume that brackets are sorted in ascending order
            for (let i = brackets.length - 1; i >= 0; i--) {
                const bracket = brackets[i];

                if (income < bracket.min) {
                    continue
                }
                if (expense <= 0) {
                    break;
                }

                const bracketGrossIncome = income - bracket.min;
                income -= bracketGrossIncome;

                const bracketTaxPayable = bracketGrossIncome * bracket.rate;
                const bracketNetIncome = bracketGrossIncome - bracketTaxPayable;

                const expenseInBracket = Math.min(bracketNetIncome, expense);
                expense -= expenseInBracket;

                const usedEarningsInBracket = expenseInBracket / (1.0 - bracket.rate);
                result.requiredEarnings += usedEarningsInBracket;
                result.federalTax += (usedEarningsInBracket * bracket.fedRate);
                result.provincialTax += (usedEarningsInBracket * bracket.provRate);
            }
            result.requiredEarnings += expense;
            return result;
        }

        const calc = calculateRequiredEarningsAndTax(subtotal, annualIncome, brackets);
        document.getElementById('subtotal-2').textContent = `${subtotal.toFixed(2)}`;
        document.getElementById('federal-tax').textContent = `${calc.federalTax.toFixed(2)}`;
        document.getElementById('provincial-tax').textContent = `${calc.provincialTax.toFixed(2)}`;
        document.getElementById('required-earnings').textContent = `${calc.requiredEarnings.toFixed(2)}`;

        timeFormDidChange();
        retirementFormDidChange();
    }

    document.getElementById('income').addEventListener('input', incomeFormDidChange);
    document.getElementById('incomeForm').addEventListener('submit', incomeFormDidChange);

    function timeFormDidChange() {
        const requiredEarnings = parseFloat(document.getElementById('required-earnings').textContent) || 0.0;
        const annualIncome = parseFloat(document.getElementById('income').value);
        const daysWorkedPerYear = parseFloat(document.getElementById('days-worked').value);

        const percentOfYear = requiredEarnings / annualIncome;
        const workingDaysRequired = percentOfYear * daysWorkedPerYear;
        const calendarDaysRequired = percentOfYear * 365.0;
        document.getElementById('required-working-days').textContent = `${workingDaysRequired.toFixed(1)}`;
        document.getElementById('required-calendar-days').textContent = `${calendarDaysRequired.toFixed(1)}`;
    }

    document.getElementById('days-worked').addEventListener('input', timeFormDidChange);
    document.getElementById('timeForm').addEventListener('submit', timeFormDidChange);

    function retirementFormDidChange() {
        const requiredEarnings = parseFloat(document.getElementById('required-earnings').textContent) || 0.0;
        const yearsToRetirement = parseFloat(document.getElementById('years-to-retirement').value) || 30;
        const expectedReturn = parseFloat(document.getElementById('expected-return').value) / 100.0 || 0.07;

        // Calculate compound growth: FV = PV * (1 + r)^n
        const foregoneRetirementSavings = requiredEarnings * Math.pow(1 + expectedReturn, yearsToRetirement);
        
        document.getElementById('foregone-savings').textContent = `${foregoneRetirementSavings.toFixed(2)}`;
    }

    document.getElementById('years-to-retirement').addEventListener('input', retirementFormDidChange);
    document.getElementById('expected-return').addEventListener('input', retirementFormDidChange);
    document.getElementById('retirementForm').addEventListener('submit', retirementFormDidChange);

    function loadFromStorage() {
        const savedIncome = localStorage.getItem('sumcost-annual-income');
        if (savedIncome) {
            document.getElementById('income').value = savedIncome;
        }

        const savedProvince = localStorage.getItem('sumcost-province');
        if (savedProvince) {
            document.getElementById('province').value = savedProvince;
        }
    }

    window.addEventListener('load', function () {
        loadFromStorage();
        purchaseFormDidChange();
    });

    // window.addEventListener('resize', doSomething);
    // window.addEventListener('orientationchange', doSomething);
</script>
    
    <!-- 100% privacy-first analytics -->
    <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
    
</body>
</html>
